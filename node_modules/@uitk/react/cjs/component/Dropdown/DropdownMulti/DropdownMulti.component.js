"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require('../../../external/@babel/runtime/helpers/slicedToArray.js'),t=require('../../../external/@babel/runtime/helpers/toConsumableArray.js'),n=require('react'),o=require('styled-components'),r=require('../../../constant.js'),l=require('@uitk/react-icons'),i=require('../types.js'),u=require('../DropdownReducer.js'),c=require('./DropdownMultiItem/DropdownMultiItem.component.js'),a=require('@react-aria/visually-hidden'),d=require('./DropdownMultiGroup/DropdownMultiGroup.component.js'),s=require('../styles/commonStyles.js'),f=require('../utilities/dropdownUtility.js'),p=require('../DropdownButton/DropdownButton.component.js'),m=require('../../Checkbox/Checkbox.component.js');function v(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=v(n),y=v(o),g=y.default(p.DropdownButton).withConfig({displayName:"DropdownMulticomponent__DropdownMultiButton",componentId:"sc-1v1vil0-0"})(["",""],(function(e){var t=e.open,n=e.triggerHeight;return o.css(["",";"],t&&o.css(["overflow-y:scroll;height:",";"],n))})),w=y.default.span.withConfig({displayName:"DropdownMulticomponent__DropdownMultiButtonText",componentId:"sc-1v1vil0-1"})([""]),b=y.default.div.withConfig({displayName:"DropdownMulticomponent__DropdownMenuContainer",componentId:"sc-1v1vil0-2"})(["",""],(function(e){var t=e.open,n=e.theme,l=n.animation,i=n.border,u=n.color,c=n.elevation;return o.css(["width:100%;display:none;padding:0;margin:0;border:none;outline:none;margin:0;overflow-y:auto;overflow-x:hidden;background-color:",";border-radius:",";animation:slide-down "," cubic-bezier(0,0,0.38,0.9);position:absolute;max-height:23.75rem;box-shadow:",";border:"," ",";margin-top:2px;z-index:",";",";"],u.background.surface.base.value,i.radius.form.element.value,l.duration.animate.fast.value,c.medium.value,u.border.base.value,i.width.base.value,r.Z_INDEX.ZERO,t&&I)})),D=y.default.fieldset.withConfig({displayName:"DropdownMulticomponent__DropdownFieldset",componentId:"sc-1v1vil0-3"})(["",""],(function(e){var t=e.theme.spacing;return"\n    padding: 0 ".concat(t.xs.value," ").concat(t.base.value,";\n    margin: ").concat(t.xxs.value," 0 0 0;\n    border: none;\n  ")})),E=y.default.legend.withConfig({displayName:"DropdownMulticomponent__DropdownFieldsetLegend",componentId:"sc-1v1vil0-4"})(["",""],(function(e){var t=e.theme,n=t.color,o=t.font,r=t.spacing;return"\n    padding: ".concat(r.xs.value," 0;\n    margin-bottom: ").concat(r.xxs.value,";\n    color: ").concat(n.text.forms.label.value,";\n    font-weight: ").concat(o.weight.form.labels.value,";\n  ")})),x=y.default(l.CaretDownCentered).withConfig({displayName:"DropdownMulticomponent__DropdownIcon",componentId:"sc-1v1vil0-5"})(["position:absolute;right:",";top:calc(50% - 12px);"],(function(e){return e.theme.spacing.sm.value})),I=o.css(["display:block;"]),C=y.default.div.withConfig({displayName:"DropdownMulticomponent__SelectAllContainer",componentId:"sc-1v1vil0-6"})(["",""],(function(e){var t=e.isChecked;return o.css([""," ",";&:hover,&:focus-within{","{","}}"],s.selectAllContainerStyles,t&&s.selectAllCheckedStyles,k,s.dropdownMultiItemActiveStyles)})),k=y.default(m.Checkbox).withConfig({displayName:"DropdownMulticomponent__SelectAllCheckbox",componentId:"sc-1v1vil0-7"})(["",""],(function(e){var t=e.checked,n=e.theme.font;return o.css(["  "," label{font-weight:",";}"],s.selectAllCheckboxStyles,n.weight[t?"strong":"base"].value)})),M=function(e,t,n){for(var o=e;o<n.length;o++)if(t===n[o])return o;return-1},_=function(e){var n=[];return e.forEach((function(e){Array.isArray(e.value)?n.push.apply(n,t.default(e.value)):n.push(e)})),n},A=function e(n){var o=[];return n.forEach((function(n){Array.isArray(n.value)?o.push.apply(o,t.default(e(n.value))):o.push(n.label.charAt(0).toLowerCase())})),o},S=function(t){var o=t.buttonDescriptiveText,l=void 0===o?"Press enter or space to expand the list and use tab key to navigate through the list":o,s=t.disabled,p=t.error,m=t.fieldsetLabel,v=t.id,y=t.initialValues,I=void 0===y?[]:y,S=t.items,T=t.labelledBy,q=t.onBlur,j=t.onChange,R=t.placeholderText,G=void 0===R?"Please Select":R,N=t.required,O=t.selectAllLabel,K=void 0===O?"Select All":O,B=t.selectGroupLabel,H=void 0===B?"Select Group":B,L=t.selectedText,F=void 0===L?"selected":L,P=t.value,z=n.useRef(),V=n.useRef(),Z=n.useRef(),U=n.useReducer(u.dropdownReducer,{open:!1,touched:!1,selectedItems:_(P||I),focusedIndex:-1,initialCharacters:[]}),W=e.default(U,2),X=W[0],J=X.focusedIndex,Q=X.initialCharacters,Y=X.open,$=X.touched,ee=X.selectedItems,te=X.triggerHeight,ne=W[1],oe=n.useMemo((function(){return f.getMultiActions(ne)}),[ne]),re=n.useMemo((function(){return _(S)}),[S]),le=n.useMemo((function(){var e=new Map;return re.forEach((function(t){e.set(t.id,n.createRef())})),e}),[re]),ie=n.useMemo((function(){return function(e){return le.get(e)}}),[S,le]),ue=a.useVisuallyHidden().visuallyHiddenProps,ce=function(){oe.closeDropdown(),$&&(null==q||q())},ae=function(e){!function(e,t,n,o){var r,l,i=e.target;(null===(r=t.current)||void 0===r?void 0:r.contains(document.activeElement))&&i.htmlFor!==n&&!(null===(l=t.current)||void 0===l?void 0:l.contains(i))&&o()}(e,z,v,ce)},de=function(e,t){!function(e,t,n,o){e.key!==r.Key.TAB||e.shiftKey||t!==n-1||o()}(e,t,re.length,oe.closeDropdown)};return n.useEffect((function(){return $&&document.addEventListener("mousedown",ae),function(){return document.removeEventListener("mousedown",ae)}}),[$]),n.useEffect((function(){var e;ne({type:i.DropdownActionType.SET_TRIGGER_HEIGHT,payload:V.current.offsetHeight+"px"}),Y&&(null===(e=Z.current)||void 0===e||e.focus())}),[Y]),n.useEffect((function(){null==j||j(ee)}),[ee]),n.useEffect((function(){Z.current&&(Z.current.indeterminate=function(e,t){return e.length>0&&e.length!==t.length}(ee,re))}),[S,ee]),n.useEffect((function(){ne({type:i.DropdownActionType.SET_INITIAL_CHARACTERS,payload:A(S)})}),[S]),n.useEffect((function(){var e,t;!P||(e=ee,(t=P)&&(null==e?void 0:e.length)===(null==t?void 0:t.length)&&e.every((function(e,n){return e===t[n]})))||ne({type:i.DropdownActionType.SET_ITEMS,payload:_(P)})}),[P]),h.default.createElement("div",{ref:z},h.default.createElement(g,{"data-testid":"dropdown-multi-btn",type:"button",error:Boolean(p),disabled:s,id:v,"aria-labelledby":T,"aria-describedby":"".concat(v,"-support-text-multi"),"aria-expanded":Y,"aria-required":N,onClick:function(){return ne({type:i.DropdownActionType.TOGGLE_DROPDOWN})},open:Y,triggerHeight:te,onKeyDown:function(e){var t,n=null===(t=V.current)||void 0===t?void 0:t.contains(document.activeElement);!function(e,t,n,o,l,i){e.key!==r.Key.TAB||t&&!e.shiftKey?e.key===r.Key.ESC&&l():(l(),n&&o&&(null==i||i()))}(e,Y,$,n,oe.closeDropdown,q)},ref:V},h.default.createElement(w,{id:"".concat(v,"-text")},function(e,t){return e.length>0?e.map((function(e){return e.label})).join(", "):t}(ee,G),ee.length>0&&h.default.createElement("span",Object.assign({},ue),"(",F,")")),h.default.createElement("span",Object.assign({id:"".concat(v,"-support-text-multi")},ue),l),h.default.createElement(x,{size:"m"})),h.default.createElement(b,{open:Y,onKeyDown:function(e){var t,n;switch(e.key){case r.Key.ESC:oe.closeDropdown(),null==V||V.current.focus();break;case r.Key.HOME:null===(t=le.get(re[0].id).current)||void 0===t||t.focus();break;case r.Key.END:null===(n=le.get(re[re.length-1].id).current)||void 0===n||n.focus();break;default:(function(e,t){return 1===e.length&&e.match(/\S/)&&t.indexOf(e)>-1})(e.key,Q)&&function(e,t,n,o,r){var l,i,u=M(n+1,e,t);-1===u&&-1!==n&&(u=M(0,e,t)),u>-1&&(null===(l=o.get(r[u].id).current)||void 0===l||l.focus(),null===(i=o.get(r[u].id).current)||void 0===i||i.scrollIntoView({block:"center"}))}(e.key,Q,J,le,re)}}},h.default.createElement(D,null,h.default.createElement(E,null,h.default.createElement("span",null,m)),h.default.createElement(C,{isChecked:ee.length===re.length},h.default.createElement(k,{id:"".concat(v,"-select-all"),checkboxRef:Z,checked:ee.length===re.length,onChange:function(e){return oe.onSelectAll(e,re)},onFocus:function(){return oe.onFocusItem(-1)}},K)),Y&&S.map((function(e,t){return Array.isArray(e.value)?h.default.createElement(d.DropdownMultiGroup,{key:e.label,rootId:"".concat(v,"-item-").concat(t),dropdownGroup:e,selectedItems:ee,getItemRef:ie,flatItems:re,onSelectItems:oe.onSelectItems,onFocus:oe.onFocusItem,onKeyDownGroupItem:de,selectGroupLabel:H}):h.default.createElement(c.DropdownMultiItem,{key:e.label,id:"".concat(v,"-item-").concat(t),selected:ee.indexOf(e)>-1,checked:ee.indexOf(e)>-1,onChange:function(){return oe.onSelectItems([e],ee)},onFocus:function(){return oe.onFocusItem(re.indexOf(e))},checkboxRef:ie(e.id),label:e.label,onKeyDownItem:function(t){return de(t,re.indexOf(e))}})})))))},T=y.default(S).withConfig({displayName:"DropdownMulticomponent__DropdownMulti",componentId:"sc-1v1vil0-8"})([""]);exports.DropdownMulti=T;
