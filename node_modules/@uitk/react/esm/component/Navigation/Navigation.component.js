import e from'../../external/@babel/runtime/helpers/toConsumableArray.js';import{__rest as n}from'tslib';import t,{memo as a,useMemo as o,useEffect as i,useRef as r}from'react';import{TrackingConstants as l,Key as c}from'../../constant.js';import{NavType as s}from'./types.js';import u,{css as m}from'styled-components';import{getStylesForVariant as p}from'./styles/index.js';import{useButton as f}from'@react-aria/button';import{useLink as v}from'@react-aria/link';import d from'classnames';import{getActiveStateForRoute as g,isPanel as h}from'./NavigationContext/NavigationReducer.js';import{useNavigationExpanded as b,useVerticalNavigationDefinedCallback as k}from'./VerticalNavigationContext/VerticalNavigationContext.js';import{useNavTypes as N}from'../Toolkit/ToolkitNavigationContext/ToolkitNavigationContext.js';import{NavigationProvider as y,useNavigationVariant as C,useNavigationRefs as E,useNavigationState as x,useNavigationDispatch as I,useInternalCallbacks as w,useNavigationOptions as _,useNavigationConfig as L}from'./NavigationContext/NavigationContext.js';import{useHeaderExpandCallback as j}from'../Header/HeaderContext/HeaderContext.js';import{getNativeProps as O,anchorProperties as P,buttonProperties as T}from'../../utility/getNativeProps/getNativeProps.js';import A from'../../external/@uitk/react-icons/esm/CaretUpCentered.js';import D from'../../external/@uitk/react-icons/esm/CaretDownCentered.js';import R from'../../external/@uitk/react-icons/esm/CaretRight.js';import{useBreakpoint as S}from'../../hook/useBreakpoint/index.js';import{useTracking as V}from'../TrackingProvider/TrackingProvider.component.js';var z=a((function(n){var a=n.className,c=n.config,u=n.internalCallbacks,m=n.isDesktop;n.open;var p=n.useLocation,f=n.variant,v=n.ariaLabel,h=p(),C=o((function(){return g(c,{route:h,isDesktop:m})}),[c]),E=S().breakpoint;m="large"===E;var x=b(),I=k(),w=V();i((function(){w.mount(l.components.Navigation.id)}),[w]),i((function(){I(f===s.VERTICAL)}),[]);var _=r(null),L=o((function(){return{openPanelButtonRef:_}}),[]),j=N(),O=j.navTypes,P=j.setNavTypes;return i((function(){O.includes(f)||P((function(n){return[].concat(e(n),[f])}))}),[]),t.createElement(y,{initialState:C,useLocation:p,variant:f,internalCallbacks:u,refs:L,config:c},t.createElement(M,{isDesktop:m,ariaLabel:v,open:x,isGlobalWithSecondary:(null==O?void 0:O.length)>1&&f===s.GLOBAL,className:d("uitk-navigation",a)}))}));z.displayName="Navigation";var B=u.label.withConfig({displayName:"Navigationcomponent__MenuLabel",componentId:"ih4u3c-0"})(["",""],(function(e){var n=e.theme,t=n.spacing,a=n.font,o=n.color;return m(["display:block;padding:"," 0;font-size:",";font-weight:",";font-family:",";color:",";"],t.m.value,a.size.heading.h4.value,a.weight.heading.h4.value,a.family.base.value,o.text.primary.value)})),G=function(e){var n=e.className,a=e.isDesktop,o=e.ariaLabel,l=r(null),u=E().openPanelButtonRef,m=x(),p=C(),f="".concat(p.toLowerCase()," navigation"),v=I().closeNav,d=j(),g=function(e){var n;!function(e,n){return e.key===c.ESC&&n}(e,a)?function(e,n){var t;return e.key===c.TAB&&!(null===(t=n.current)||void 0===t?void 0:t.contains(e.target))}(e,l)&&function(e,n,t,a){e&&n!==s.VERTICAL?t():a(!1)}(a,p,v,d):(null===(n=u.current)||void 0===n||n.focus(),v())},b=function(e){!function(e,n,t,a){var o;return n&&t!==s.VERTICAL&&!(null===(o=a.current)||void 0===o?void 0:o.contains(e.target))}(e,a,p,l)?function(e,n,t){var a;return!n&&!(null===(a=t.current)||void 0===a?void 0:a.contains(e.target))}(e,a,l)&&d(!1):v()},k=function(e){return e.expanded?u:null};return i((function(){return document.addEventListener("click",b),function(){return document.removeEventListener("click",b)}}),[v,a]),i((function(){return document.addEventListener("keyup",g),function(){return document.removeEventListener("keyup",g)}}),[v,a]),t.createElement(Z,{ref:l,variant:p,isDesktop:a,"aria-label":o||f,className:n},function(e,n){return!e&&t.createElement(B,null,n.label||"Menu")}(a,m),t.createElement($,{isDesktop:a,level:0,variant:p},m&&m.links.map((function(e,n){return h(e)?t.createElement(Y,Object.assign({buttonRef:k(e),key:n,level:0,parentIconOffset:0},e)):t.createElement(oe,Object.assign({key:n,level:0,parentIconOffset:0},e))}))))},H=function(e){var n=e.className,a=e.isDesktop,o=e.ariaLabel;return C()===s.VERTICAL?t.createElement(q,null,t.createElement(G,{isDesktop:a,className:n,ariaLabel:o})):t.createElement(t.Fragment,null,t.createElement(G,{isDesktop:a,className:n,ariaLabel:o}))},W=m(["",""],(function(e){var n=e.theme,t=n.spacing,a=n.color;return"\n    flex-direction: column;\n    background:  ".concat(a.background.navigation.responsive.value,"; \n    padding: 0 ").concat(t.m.value," ").concat(t.xl.value," ").concat(t.m.value,";\n  ")})),F=m(["",""],(function(e){var n=e.theme,t=n.elevation,a=n.border,o=n.color;return"\n    box-shadow: ".concat(t.higher.horizontal.bottom.value,";\n    border-bottom: solid ").concat(a.width.large.value," ").concat(o.border.brand.base.value,";\n  ")})),M=u(H).withConfig({displayName:"Navigationcomponent__NavigationContainer",componentId:"ih4u3c-1"})(["",""],(function(e){var n=e.isDesktop,t=e.isGlobalWithSecondary,a=e.open;return m(["display:",";",";",";"],a||n?"flex":"none",!n&&a&&W,!n&&a&&!t&&F)})),U=m(["",""],(function(e){var n=e.theme.color;return m(["background:",";color:",";width:100%;"],n.background.navigation.responsive.value,n.text.navigation.global.value)})),Z=u.nav.withConfig({displayName:"Navigationcomponent__Nav",componentId:"ih4u3c-2"})(["",";"],(function(e){var n=e.isDesktop,t=e.variant;return m(["button{font-family:inherit;font-size:inherit;letter-spacing:inherit;background:none;border:none;outline:none;cursor:pointer;}a{text-decoration:none;}svg{fill:currentColor;}"," ",""],!n&&U,p(t).navStyles)})),q=u.aside.withConfig({displayName:"Navigationcomponent__VerticalAside",componentId:"ih4u3c-3"})([""]),J=u.span.withConfig({displayName:"Navigationcomponent__PanelText",componentId:"ih4u3c-4"})(["flex-grow:1;"]),K=u.span.withConfig({displayName:"Navigationcomponent__CaretWrapper",componentId:"ih4u3c-5"})(["",""],(function(e){var n=e.variant;return m(["display:inline-flex;&& svg{fill:currentColor;}",""],p(n).caretStyles)})),Q=function(e){var n,a=e.expanded,o=e.isDesktop,i=e.level,r=e.variant,l=L(),c=l.panelClosedIcon,u=l.panelExpandedIcon,m=l.panelFlyoutIcon;return n=o&&0!==i&&r!==s.VERTICAL?m||t.createElement(R,{size:"m"}):a?u||t.createElement(A,{size:"m"}):c||t.createElement(D,{size:"m"}),t.createElement(K,{variant:r,level:i},n)},X=u.span.withConfig({displayName:"Navigationcomponent__PanelItemTriggerContent",componentId:"ih4u3c-6"})(["",""],(function(e){var n=e.theme.font;return m(["flex-direction:column;overflow-wrap:break-word;&:after{display:block;content:attr(data-text);font-weight:",";height:0;overflow:hidden;visibility:hidden;}"],n.weight.strong.value)})),Y=function e(n){var a=n.active,o=n.buttonRef,i=n.expanded,r=n.icon,l=n.label,c=n.level,s=n.links,u=n.customContent,m=n.parentIconOffset,p=C(),f=I(),v=f.closePanel,d=f.openPanel,g="large"===S().breakpoint,b=i?function(){return v(l)}:function(){return d(l,p,g)},k=r?m+1:m;return t.createElement(re,{key:l,isDesktop:g,level:c,expanded:i,active:a,variant:p,parentIconOffset:m},t.createElement(ee,{"aria-expanded":!!i,onPress:b,buttonRef:o,"data-testid":"nav-button"},t.createElement(J,null,!u&&r&&t.createElement(ie,null,r),u&&t.createElement(ie,null,u),t.createElement(X,{"data-text":l},l," ")),t.createElement(Q,{variant:p,level:c,expanded:i,isDesktop:g})),i&&t.createElement($,{level:c+1,isDesktop:g,variant:p},s.map((function(n){return h(n)?t.createElement(e,Object.assign({parentIconOffset:k,key:n.label,level:c+1},n)):t.createElement(oe,Object.assign({parentIconOffset:k,key:n.label,level:c+1},n))}))))},$=u.ul.withConfig({displayName:"Navigationcomponent__Panel",componentId:"ih4u3c-7"})(["",""],(function(e){var n=e.variant;return m(["margin:0;padding:0;list-style:none;display:flex;flex-direction:column;flex-grow:1;z-index:10000;",""],p(n).panelStyles)})),ee=u((function(e){var a=e.buttonRef,o=e.children,i=e.className,l=n(e,["buttonRef","children","className"]),c=r(),s=a||c,u=f(l,s).buttonProps;return t.createElement("button",Object.assign({},u,{ref:s,className:i}),o)})).withConfig({displayName:"Navigationcomponent__PanelButton",componentId:"ih4u3c-8"})(["display:inline-block;"]),ne=function(e){var n=e.children,a=e.url,o=r(),i=v(O(e,P),o).linkProps;return t.createElement("a",Object.assign({},i,{ref:o,href:a}),n)},te=function(e){var n=r(),a=e.children,o=f(O(e,T),n).buttonProps;return t.createElement("button",Object.assign({},o,{ref:n}),a)},ae=u.span.withConfig({displayName:"Navigationcomponent__PanelItemActionContent",componentId:"ih4u3c-9"})(["",""],(function(e){var n=e.theme.font;return m(["overflow-wrap:break-word;flex-direction:column;&:after{display:block;content:attr(data-text);font-weight:",";height:0;overflow:hidden;visibility:hidden;}"],n.weight.strong.value)})),oe=function(e){var a=C(),o=I(),i=E().openPanelButtonRef,r=w().onActionItemClick,l="large"===S().breakpoint,c=_(),u=c.linkAs,m=c.onLinkClick,p=u||(e.onClick?te:ne),f=e.level,v=e.parentIconOffset,d=n(e,["level","parentIconOffset"]),g=d.active,h=d.icon,b=d.label,k=d.customContent,N=d.onClick?d.onClick:m,y=d.active?{"aria-current":!0}:{};return t.createElement(le,{key:b,isDesktop:l,level:f,active:g,variant:a,parentIconOffset:v},t.createElement(p,Object.assign({},d,y,{onClick:function(e){r&&r(l),l&&(function(e,n){e!==s.GLOBAL&&e!==s.HORIZONTAL||n.closeNav()}(a,o),function(e,n,t){0!==n&&e!==s.VERTICAL&&(null==t?void 0:t.current)&&t.current.focus()}(a,f,i)),N&&N(e,d)},"data-testid":"nav-link"}),t.createElement("span",null,!k&&h&&t.createElement(ie,null,h),k&&t.createElement(ie,null,k),t.createElement(ae,{"data-text":b},b))))},ie=u.span.withConfig({displayName:"Navigationcomponent__IconWrapper",componentId:"ih4u3c-10"})(["display:inline-flex;align-items:center;margin-right:",";"],(function(e){return e.theme.spacing.xs.value})),re=u.li.withConfig({displayName:"Navigationcomponent__PanelItemTrigger",componentId:"ih4u3c-11"})(["",""],(function(e){var n=e.variant;return m(["",""],p(n).panelItemTriggerStyles)})),le=u.li.withConfig({displayName:"Navigationcomponent__PanelItemAction",componentId:"ih4u3c-12"})(["",""],(function(e){var n=e.variant;return m(["",""],p(n).panelItemActionStyles)}));export{z as Navigation,M as NavigationContainer};
