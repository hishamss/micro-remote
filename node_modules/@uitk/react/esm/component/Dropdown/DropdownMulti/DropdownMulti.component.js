import e from'../../../external/@babel/runtime/helpers/slicedToArray.js';import n from'../../../external/@babel/runtime/helpers/toConsumableArray.js';import t,{useRef as o,useReducer as r,useMemo as i,createRef as l,useEffect as c}from'react';import a,{css as u}from'styled-components';import{Z_INDEX as d,Key as s}from'../../../constant.js';import{CaretDownCentered as m}from'@uitk/react-icons';import{DropdownActionType as p}from'../types.js';import{dropdownReducer as f}from'../DropdownReducer.js';import{DropdownMultiItem as v}from'./DropdownMultiItem/DropdownMultiItem.component.js';import{useVisuallyHidden as h}from'@react-aria/visually-hidden';import{DropdownMultiGroup as g}from'./DropdownMultiGroup/DropdownMultiGroup.component.js';import{selectAllContainerStyles as w,selectAllCheckedStyles as b,dropdownMultiItemActiveStyles as y,selectAllCheckboxStyles as x}from'../styles/commonStyles.js';import{getMultiActions as D}from'../utilities/dropdownUtility.js';import{DropdownButton as I}from'../DropdownButton/DropdownButton.component.js';import{Checkbox as E}from'../../Checkbox/Checkbox.component.js';var k=a(I).withConfig({displayName:"DropdownMulticomponent__DropdownMultiButton",componentId:"sc-1v1vil0-0"})(["",""],(function(e){var n=e.open,t=e.triggerHeight;return u(["",";"],n&&u(["overflow-y:scroll;height:",";"],t))})),C=a.span.withConfig({displayName:"DropdownMulticomponent__DropdownMultiButtonText",componentId:"sc-1v1vil0-1"})([""]),_=a.div.withConfig({displayName:"DropdownMulticomponent__DropdownMenuContainer",componentId:"sc-1v1vil0-2"})(["",""],(function(e){var n=e.open,t=e.theme,o=t.animation,r=t.border,i=t.color,l=t.elevation;return u(["width:100%;display:none;padding:0;margin:0;border:none;outline:none;margin:0;overflow-y:auto;overflow-x:hidden;background-color:",";border-radius:",";animation:slide-down "," cubic-bezier(0,0,0.38,0.9);position:absolute;max-height:23.75rem;box-shadow:",";border:"," ",";margin-top:2px;z-index:",";",";"],i.background.surface.base.value,r.radius.form.element.value,o.duration.animate.fast.value,l.medium.value,i.border.base.value,r.width.base.value,d.ZERO,n&&T)})),M=a.fieldset.withConfig({displayName:"DropdownMulticomponent__DropdownFieldset",componentId:"sc-1v1vil0-3"})(["",""],(function(e){var n=e.theme.spacing;return"\n    padding: 0 ".concat(n.xs.value," ").concat(n.base.value,";\n    margin: ").concat(n.xxs.value," 0 0 0;\n    border: none;\n  ")})),A=a.legend.withConfig({displayName:"DropdownMulticomponent__DropdownFieldsetLegend",componentId:"sc-1v1vil0-4"})(["",""],(function(e){var n=e.theme,t=n.color,o=n.font,r=n.spacing;return"\n    padding: ".concat(r.xs.value," 0;\n    margin-bottom: ").concat(r.xxs.value,";\n    color: ").concat(t.text.forms.label.value,";\n    font-weight: ").concat(o.weight.form.labels.value,";\n  ")})),S=a(m).withConfig({displayName:"DropdownMulticomponent__DropdownIcon",componentId:"sc-1v1vil0-5"})(["position:absolute;right:",";top:calc(50% - 12px);"],(function(e){return e.theme.spacing.sm.value})),T=u(["display:block;"]),j=a.div.withConfig({displayName:"DropdownMulticomponent__SelectAllContainer",componentId:"sc-1v1vil0-6"})(["",""],(function(e){var n=e.isChecked;return u([""," ",";&:hover,&:focus-within{","{","}}"],w,n&&b,G,y)})),G=a(E).withConfig({displayName:"DropdownMulticomponent__SelectAllCheckbox",componentId:"sc-1v1vil0-7"})(["",""],(function(e){var n=e.checked,t=e.theme.font;return u(["  "," label{font-weight:",";}"],x,t.weight[n?"strong":"base"].value)})),N=function(e,n,t){for(var o=e;o<t.length;o++)if(n===t[o])return o;return-1},O=function(e){var t=[];return e.forEach((function(e){Array.isArray(e.value)?t.push.apply(t,n(e.value)):t.push(e)})),t},L=function e(t){var o=[];return t.forEach((function(t){Array.isArray(t.value)?o.push.apply(o,n(e(t.value))):o.push(t.label.charAt(0).toLowerCase())})),o},R=a((function(n){var a=n.buttonDescriptiveText,u=void 0===a?"Press enter or space to expand the list and use tab key to navigate through the list":a,d=n.disabled,m=n.error,w=n.fieldsetLabel,b=n.id,y=n.initialValues,x=void 0===y?[]:y,I=n.items,E=n.labelledBy,T=n.onBlur,R=n.onChange,B=n.placeholderText,F=void 0===B?"Please Select":B,H=n.required,K=n.selectAllLabel,P=void 0===K?"Select All":K,z=n.selectGroupLabel,q=void 0===z?"Select Group":z,V=n.selectedText,U=void 0===V?"selected":V,W=n.value,Z=o(),J=o(),Q=o(),X=r(f,{open:!1,touched:!1,selectedItems:O(W||x),focusedIndex:-1,initialCharacters:[]}),Y=e(X,2),$=Y[0],ee=$.focusedIndex,ne=$.initialCharacters,te=$.open,oe=$.touched,re=$.selectedItems,ie=$.triggerHeight,le=Y[1],ce=i((function(){return D(le)}),[le]),ae=i((function(){return O(I)}),[I]),ue=i((function(){var e=new Map;return ae.forEach((function(n){e.set(n.id,l())})),e}),[ae]),de=i((function(){return function(e){return ue.get(e)}}),[I,ue]),se=h().visuallyHiddenProps,me=function(){ce.closeDropdown(),oe&&(null==T||T())},pe=function(e){!function(e,n,t,o){var r,i,l=e.target;(null===(r=n.current)||void 0===r?void 0:r.contains(document.activeElement))&&l.htmlFor!==t&&!(null===(i=n.current)||void 0===i?void 0:i.contains(l))&&o()}(e,Z,b,me)},fe=function(e,n){!function(e,n,t,o){e.key!==s.TAB||e.shiftKey||n!==t-1||o()}(e,n,ae.length,ce.closeDropdown)};return c((function(){return oe&&document.addEventListener("mousedown",pe),function(){return document.removeEventListener("mousedown",pe)}}),[oe]),c((function(){var e;le({type:p.SET_TRIGGER_HEIGHT,payload:J.current.offsetHeight+"px"}),te&&(null===(e=Q.current)||void 0===e||e.focus())}),[te]),c((function(){null==R||R(re)}),[re]),c((function(){Q.current&&(Q.current.indeterminate=function(e,n){return e.length>0&&e.length!==n.length}(re,ae))}),[I,re]),c((function(){le({type:p.SET_INITIAL_CHARACTERS,payload:L(I)})}),[I]),c((function(){var e,n;!W||(e=re,(n=W)&&(null==e?void 0:e.length)===(null==n?void 0:n.length)&&e.every((function(e,t){return e===n[t]})))||le({type:p.SET_ITEMS,payload:O(W)})}),[W]),t.createElement("div",{ref:Z},t.createElement(k,{"data-testid":"dropdown-multi-btn",type:"button",error:Boolean(m),disabled:d,id:b,"aria-labelledby":E,"aria-describedby":"".concat(b,"-support-text-multi"),"aria-expanded":te,"aria-required":H,onClick:function(){return le({type:p.TOGGLE_DROPDOWN})},open:te,triggerHeight:ie,onKeyDown:function(e){var n,t=null===(n=J.current)||void 0===n?void 0:n.contains(document.activeElement);!function(e,n,t,o,r,i){e.key!==s.TAB||n&&!e.shiftKey?e.key===s.ESC&&r():(r(),t&&o&&(null==i||i()))}(e,te,oe,t,ce.closeDropdown,T)},ref:J},t.createElement(C,{id:"".concat(b,"-text")},function(e,n){return e.length>0?e.map((function(e){return e.label})).join(", "):n}(re,F),re.length>0&&t.createElement("span",Object.assign({},se),"(",U,")")),t.createElement("span",Object.assign({id:"".concat(b,"-support-text-multi")},se),u),t.createElement(S,{size:"m"})),t.createElement(_,{open:te,onKeyDown:function(e){var n,t;switch(e.key){case s.ESC:ce.closeDropdown(),null==J||J.current.focus();break;case s.HOME:null===(n=ue.get(ae[0].id).current)||void 0===n||n.focus();break;case s.END:null===(t=ue.get(ae[ae.length-1].id).current)||void 0===t||t.focus();break;default:(function(e,n){return 1===e.length&&e.match(/\S/)&&n.indexOf(e)>-1})(e.key,ne)&&function(e,n,t,o,r){var i,l,c=N(t+1,e,n);-1===c&&-1!==t&&(c=N(0,e,n)),c>-1&&(null===(i=o.get(r[c].id).current)||void 0===i||i.focus(),null===(l=o.get(r[c].id).current)||void 0===l||l.scrollIntoView({block:"center"}))}(e.key,ne,ee,ue,ae)}}},t.createElement(M,null,t.createElement(A,null,t.createElement("span",null,w)),t.createElement(j,{isChecked:re.length===ae.length},t.createElement(G,{id:"".concat(b,"-select-all"),checkboxRef:Q,checked:re.length===ae.length,onChange:function(e){return ce.onSelectAll(e,ae)},onFocus:function(){return ce.onFocusItem(-1)}},P)),te&&I.map((function(e,n){return Array.isArray(e.value)?t.createElement(g,{key:e.label,rootId:"".concat(b,"-item-").concat(n),dropdownGroup:e,selectedItems:re,getItemRef:de,flatItems:ae,onSelectItems:ce.onSelectItems,onFocus:ce.onFocusItem,onKeyDownGroupItem:fe,selectGroupLabel:q}):t.createElement(v,{key:e.label,id:"".concat(b,"-item-").concat(n),selected:re.indexOf(e)>-1,checked:re.indexOf(e)>-1,onChange:function(){return ce.onSelectItems([e],re)},onFocus:function(){return ce.onFocusItem(ae.indexOf(e))},checkboxRef:de(e.id),label:e.label,onKeyDownItem:function(n){return fe(n,ae.indexOf(e))}})})))))})).withConfig({displayName:"DropdownMulticomponent__DropdownMulti",componentId:"sc-1v1vil0-8"})([""]);export{R as DropdownMulti};
